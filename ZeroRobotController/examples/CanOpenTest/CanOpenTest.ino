#include <Arduino_CAN.h>
#include "zltech_controller.h"
#include "ZLAC8015D_OD.h"

#define NODE_ID 1
zltech_controller zltech(NODE_ID);
CanMsg zltech_msg;

bool is_motor_connected = false;
int32_t left_actual_rpm = 0;
int32_t right_actual_rpm = 0;

void setup() {
  Serial.begin(115200);
  while(!Serial){
    ;
  }

  zltech.init();
  zltech.setup();
  is_motor_connected = zltech.isConnected();
}

void loop() {
  zltech.loop();
  is_motor_connected = zltech.isConnected();
  zltech.sendVelocity(-10, 10);
  zltech.readVelocity(&left_actual_rpm, &right_actual_rpm);
  // Serial.print("Left RPM: ");
  // Serial.print(left_actual_rpm);
  // Serial.print(", Right RPM: ");
  // Serial.println(right_actual_rpm);
  delay(3000);
  zltech.sendVelocity(0, 0);
  zltech.readVelocity(&left_actual_rpm, &right_actual_rpm);
  // Serial.print("Left RPM: ");
  // Serial.print(left_actual_rpm);
  // Serial.print(", Right RPM: ");
  // Serial.println(right_actual_rpm);
  delay(3000);
  zltech.sendVelocity(10, -10);
  zltech.readVelocity(&left_actual_rpm, &right_actual_rpm);
  // Serial.print("Left RPM: ");
  // Serial.print(left_actual_rpm);
  // Serial.print(", Right RPM: ");
  // Serial.println(right_actual_rpm);
  delay(3000);

  // Serial.println(is_motor_connected);

  // zltech.testFront();
  // delay(1000);
  // zltech.testStop();
  // delay(1000);
  // zltech.testBack();
  // delay(1000);
}
